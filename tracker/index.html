<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Tracker Pro | Shiv Suri</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Intensity 1-10 Border & Shadow Logic */
        .intensity-1 { border-left: 4px solid #bbf7d0; box-shadow: 0 2px 4px #f0fdf4; }
        .intensity-3 { border-left: 6px solid #fef08a; box-shadow: 0 3px 6px #fefce8; }
        .intensity-5 { border-left: 8px solid #fbbf24; box-shadow: 0 4px 8px #fffbeb; }
        .intensity-8 { border-left: 10px solid #f87171; box-shadow: 0 6px 12px #fef2f2; }
        .intensity-10 { border-left: 14px solid #dc2626; box-shadow: 0 10px 20px #fee2e2; border-top: 1px solid #fecaca; }
        
        .modal-bg { background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(4px); }
        .today-card { border-left: 3px solid #3b82f6; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen">

    <nav class="bg-white border-b sticky top-0 z-10 px-6 py-4 flex flex-wrap justify-between items-center shadow-sm">
        <div class="flex items-center gap-3">
            <div class="bg-blue-600 p-2 rounded-lg text-white">
                <i class="fas fa-tasks text-xl"></i>
            </div>
            <div>
                <h1 class="text-xl font-bold text-slate-800">Task Tracker Pro</h1>
                <p class="text-xs text-slate-500 font-medium">VP Management System</p>
            </div>
        </div>

        <div class="flex gap-4 mt-2 sm:mt-0">
            <div class="text-center px-4 py-1 bg-blue-50 rounded-full border border-blue-100">
                <span class="block text-[10px] uppercase font-bold text-blue-600">Pending</span>
                <span id="count-pending" class="text-lg font-bold text-blue-800">0</span>
            </div>
            <div class="text-center px-4 py-1 bg-green-50 rounded-full border border-green-100">
                <span class="block text-[10px] uppercase font-bold text-green-600">Done</span>
                <span id="count-done" class="text-lg font-bold text-green-800">0</span>
            </div>
        </div>
    </nav>

    <div class="max-w-[1400px] mx-auto p-4 md:p-6 grid grid-cols-12 gap-6">
        
        <aside class="col-span-12 lg:col-span-3 space-y-6">
            <div class="bg-white rounded-xl shadow-sm border p-5">
                <h2 class="font-bold text-slate-800 flex items-center gap-2 mb-4">
                    <i class="fas fa-calendar-day text-blue-500"></i> Today's Focus
                </h2>
                <div id="todayPane" class="space-y-3">
                    <p class="text-sm text-slate-400 italic text-center py-4">Loading today's priorities...</p>
                </div>
            </div>

            <div class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-xl p-5 text-white shadow-lg">
                <h3 class="text-sm font-bold opacity-70 mb-3 uppercase tracking-wider">Quick Filters</h3>
                <div class="space-y-2">
                    <button onclick="filterByRole('ALL')" class="w-full text-left px-3 py-2 rounded-lg hover:bg-white/10 transition">All Tasks</button>
                    <button onclick="filterByRole('SCHOOL-VP')" class="w-full text-left px-3 py-2 rounded-lg hover:bg-white/10 transition text-sm">üè´ School (VP)</button>
                    <button onclick="filterByRole('VARMAN METALS-VM')" class="w-full text-left px-3 py-2 rounded-lg hover:bg-white/10 transition text-sm">üè≠ Varman Metals</button>
                    <button onclick="filterByRole('COACHING-TUTION')" class="w-full text-left px-3 py-2 rounded-lg hover:bg-white/10 transition text-sm">üéì Coaching</button>
                </div>
            </div>
        </aside>

        <main class="col-span-12 lg:col-span-9">
            <div class="flex flex-wrap gap-3 mb-6">
                <div class="relative flex-grow">
                    <i class="fas fa-search absolute left-3 top-3 text-slate-400"></i>
                    <input type="text" id="searchInput" placeholder="Search tasks, descriptions, or people..." 
                           class="w-full pl-10 pr-4 py-2.5 rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none">
                </div>
                <button onclick="openModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2.5 rounded-xl font-bold shadow-lg shadow-blue-200 transition-all flex items-center gap-2">
                    <i class="fas fa-plus"></i> Add Task
                </button>
            </div>

            <div id="taskGrid" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                </div>
        </main>
    </div>

    <div id="taskModal" class="hidden fixed inset-0 z-50 modal-bg flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden animate-in fade-in zoom-in duration-200">
            <div class="p-6 border-b flex justify-between items-center">
                <h2 class="text-xl font-bold text-slate-800">Create New Management Task</h2>
                <button onclick="closeModal()" class="text-slate-400 hover:text-slate-600"><i class="fas fa-times"></i></button>
            </div>
            
            <form id="taskForm" class="p-6 space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Business Unit</label>
                        <select id="prefixSelect" class="w-full border rounded-lg p-2.5 text-sm bg-slate-50" required>
                            <option value="SCHOOL-VP">üè´ SCHOOL-VP</option>
                            <option value="VARMAN METALS-VM">üè≠ VARMAN METALS-VM</option>
                            <option value="COACHING-TUTION">üéì COACHING-TUTION</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Source (Stakeholder)</label>
                        <select id="source" class="w-full border rounded-lg p-2.5 text-sm bg-slate-50">
                            <option>Principal</option>
                            <option>Director Acad & Sys</option>
                            <option>Ms. Chandini Sahani (11-12)</option>
                            <option>Ms. Monika Khare (9-10)</option>
                            <option>Ms. Archana Rana (6-8)</option>
                            <option>Ms. Yamini Arora (3-5)</option>
                            <option>Ms. Yukti Gahlot (B-2)</option>
                            <option>Management</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Task Title</label>
                    <input type="text" id="taskTitle" placeholder="What needs to be done?" class="w-full border rounded-lg p-2.5 text-sm focus:ring-2 focus:ring-blue-500 outline-none" required>
                </div>

                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Detailed Description</label>
                    <textarea id="details" rows="3" placeholder="Context, specific instructions, or notes..." class="w-full border rounded-lg p-2.5 text-sm focus:ring-2 focus:ring-blue-500 outline-none"></textarea>
                </div>

                <div class="grid grid-cols-3 gap-4">
                    <div class="col-span-2">
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Deadline</label>
                        <input type="date" id="deadline" class="w-full border rounded-lg p-2.5 text-sm bg-slate-50" required>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Intensity (1-10)</label>
                        <input type="number" id="intensity" min="1" max="10" value="1" class="w-full border rounded-lg p-2.5 text-sm bg-slate-50">
                    </div>
                </div>

                <div class="flex gap-3 pt-4">
                    <button type="button" onclick="closeModal()" class="flex-1 py-2.5 border rounded-xl font-bold text-slate-600 hover:bg-slate-50">Cancel</button>
                    <button type="submit" class="flex-1 py-2.5 bg-blue-600 text-white rounded-xl font-bold shadow-lg shadow-blue-100 hover:bg-blue-700">Save Task</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // CONFIGURATION: Replace with your Google Apps Script URL
        const WEB_APP_URL = "YOUR_APPS_SCRIPT_URL"; 
        
        let allTasks = [];

        async function fetchTasks() {
            try {
                const response = await fetch(WEB_APP_URL);
                const data = await response.json();
                allTasks = data.mainTasks;
                renderDashboard(allTasks);
            } catch (err) {
                console.error("Fetch Error:", err);
            }
        }

        function renderDashboard(tasks) {
            const grid = document.getElementById('taskGrid');
            const todayPane = document.getElementById('todayPane');
            const todayStr = new Date().toISOString().split('T')[0];

            // Update Counts
            document.getElementById('count-pending').innerText = tasks.filter(t => t.Status !== 'Completed').length;
            document.getElementById('count-done').innerText = tasks.filter(t => t.Status === 'Completed').length;

            // Render Task Grid
            grid.innerHTML = tasks.map(task => createTaskCard(task)).join('');

            // Render Today Pane
            const todayTasks = tasks.filter(t => t.Deadline === todayStr && t.Status !== 'Completed');
            todayPane.innerHTML = todayTasks.length > 0 
                ? todayTasks.map(t => `
                    <div class="today-card bg-blue-50 p-3 rounded-lg text-sm">
                        <p class="font-bold text-blue-900">${t.TaskTitle}</p>
                        <p class="text-[10px] text-blue-600 uppercase font-bold mt-1">${t.Source}</p>
                    </div>`).join('')
                : `<p class="text-xs text-slate-400 italic text-center py-2">No urgent tasks for today</p>`;
        }

        function createTaskCard(task) {
            const intensityClass = `intensity-${task.ColorIntensity || 1}`;
            return `
                <div class="bg-white rounded-xl p-5 shadow-sm border border-slate-100 ${intensityClass} hover:shadow-md transition-shadow">
                    <div class="flex justify-between items-start mb-3">
                        <span class="text-[10px] bg-slate-100 px-2 py-0.5 rounded font-bold text-slate-500 uppercase">${task.Source}</span>
                        <div class="flex gap-2">
                             <button onclick="whatsappForward('${task.TaskTitle}', '${task.Deadline}')" class="text-green-500 hover:text-green-600"><i class="fab fa-whatsapp"></i></button>
                             <span class="text-[10px] bg-blue-50 text-blue-600 px-2 py-0.5 rounded font-bold italic">${task.Status}</span>
                        </div>
                    </div>
                    <h3 class="font-bold text-slate-800 leading-tight mb-2">${task.TaskTitle}</h3>
                    <p class="text-sm text-slate-500 line-clamp-2 mb-4">${task.Details || 'No additional details provided.'}</p>
                    <div class="flex justify-between items-center pt-3 border-t border-slate-50">
                        <div class="flex items-center gap-1.5 text-red-500">
                            <i class="far fa-clock text-xs"></i>
                            <span class="text-xs font-bold">${task.Deadline}</span>
                        </div>
                        <button class="text-xs font-bold text-blue-600 hover:underline">View Updates</button>
                    </div>
                </div>
            `;
        }

        // Search Filter
        document.getElementById('searchInput').oninput = (e) => {
            const val = e.target.value.toLowerCase();
            const filtered = allTasks.filter(t => 
                t.TaskTitle.toLowerCase().includes(val) || 
                t.Details.toLowerCase().includes(val) ||
                t.Source.toLowerCase().includes(val)
            );
            renderDashboard(filtered);
        };

        // Modal Controls
        function openModal() { document.getElementById('taskModal').classList.remove('hidden'); }
        function closeModal() { document.getElementById('taskModal').classList.add('hidden'); }

        // Form Submission
        document.getElementById('taskForm').onsubmit = async (e) => {
            e.preventDefault();
            const prefix = document.getElementById('prefixSelect').value;
            const finalTitle = `[${prefix}] ${document.getElementById('taskTitle').value}`;
            
            const payload = {
                targetSheet: "Main Tasks",
                rowData: [
                    "TASK_" + Date.now(),
                    finalTitle,
                    document.getElementById('details').value,
                    document.getElementById('source').value,
                    document.getElementById('deadline').value,
                    "Shiv Suri",
                    "",
                    "Pending",
                    "Web Dashboard",
                    new Date().toISOString(),
                    new Date().toISOString(),
                    document.getElementById('intensity').value
                ]
            };

            // Loading UI placeholder
            const btn = e.target.querySelector('button[type="submit"]');
            btn.innerText = "Saving...";
            btn.disabled = true;

            await fetch(WEB_APP_URL, { method: 'POST', body: JSON.stringify(payload) });
            
            btn.innerText = "Save Task";
            btn.disabled = false;
            closeModal();
            fetchTasks(); 
        };

        function whatsappForward(title, date) {
            const msg = encodeURIComponent(`Hi, tracking update for: ${title}. Deadline set for ${date}. Please provide status.`);
            window.open(`https://wa.me/?text=${msg}`);
        }

        // Initial Load
        fetchTasks();
    </script>
</body>
</html>
